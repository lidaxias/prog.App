<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1350" d:DesignHeight="600"
        x:Class="progMap.App.Avalonia.Views.EditorWindow"
		xmlns:vmAv="using:progMap.App.Avalonia.ViewModels"
		xmlns:converters="using:progMap.App.Avalonia.Converters"
		xmlns:vm="using:progMap.ViewModels"
		xmlns:views="using:progMap.App.Avalonia.Views"
        Title="Редактор конфигураций" Height="600" MinWidth="1400" Width="1400"
        Icon="/Assets/rss_logo_32x32.ico"
		WindowStartupLocation="CenterScreen">

	<Design.DataContext>
		<vm:EditorVm/>
	</Design.DataContext>

	<Window.Styles>
		<StyleInclude Source="/Views/GroupBox.axaml"/>
	</Window.Styles>

	<Window.DataTemplates>
		<DataTemplate DataType="vm:ChannelTypeVm">
			<TextBlock Text="{Binding Name}"/>
		</DataTemplate>
	</Window.DataTemplates>
	<Grid>
		<DockPanel LastChildFill="True">
			<Border DockPanel.Dock="Bottom" BorderThickness="0,2,0,0" BorderBrush="Gray" Padding="0" >
				<Grid DockPanel.Dock="Bottom" HorizontalAlignment="Center">
					<Grid.ColumnDefinitions>
						<ColumnDefinition/>
						<ColumnDefinition/>
						<ColumnDefinition/>
					</Grid.ColumnDefinitions>
					<Grid.RowDefinitions>
						<RowDefinition/>
						<RowDefinition/>
					</Grid.RowDefinitions>
					<Button Grid.Row="1" Content="Сохранить" Background="White" BorderBrush="#775285" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" FontWeight="DemiBold" Width="100"
                    Margin="3" Padding="3" Height="25" Click="SaveButton_Click" />

					<Button Grid.Row="1" Grid.Column="1"  Content="Сохранить как" Background="White" BorderBrush="#775285" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" FontWeight="DemiBold" Width="125"
                    Margin="3" Padding="3" Height="25" Click="SaveAsButton_Click" />

					<Button Grid.Row="1" Grid.Column="2" Background="White" BorderBrush="#775285" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" FontWeight="DemiBold" Content="Отмена" Width="100"
                    Margin="3" Padding="3" Height="25" Click="CloseButton_Click"/>
				</Grid>
			</Border>

			<ScrollViewer>
				<DockPanel Margin="3" LastChildFill="True">
					<Grid DockPanel.Dock="Bottom" HorizontalAlignment="Center">
						<Grid.ColumnDefinitions>
							<ColumnDefinition/>
							<ColumnDefinition/>
						</Grid.ColumnDefinitions>
						<Grid.RowDefinitions>
							<RowDefinition/>
							<RowDefinition/>
						</Grid.RowDefinitions>
						<Button Grid.ColumnSpan="2"  Command="{Binding AddConfigurationCommand}"
                    Margin="3" Background="WhiteSmoke" BorderBrush="#775285" FontWeight="DemiBold" Padding="3, 0" Width="150" Height="25" VerticalContentAlignment="Center" >
							<StackPanel Orientation="Horizontal">
								<Image  Source="/Assets/Add_16x.png"  Height="16" />
								<TextBlock Text="КОНФИГУРАЦИЯ"  Margin="6, 4"/>
							</StackPanel>
						</Button>
					</Grid>
					<ItemsControl ItemsSource="{Binding AllConfigurations}">
						<ItemsControl.ItemTemplate>
							<DataTemplate DataType="{x:Type vm:DeviceConfigurationVm}">
								<Border BorderBrush="#775285" Margin="4"  BorderThickness="1.5">
									<StackPanel>
										<views:GroupBox Grid.Row="0" Background="AliceBlue" Margin="5" BorderBrush="Gray" Header="Конфигурация прибора">
											<Grid>
												<Grid.ColumnDefinitions>
													<ColumnDefinition Width="30"/>
													<ColumnDefinition Width="*"/>
													<ColumnDefinition Width="*"/>
													<ColumnDefinition Width="*" MinWidth="150"/>
													<ColumnDefinition Width="*"/>
													<ColumnDefinition Width="120"/>
													<ColumnDefinition Width="120"/>
													<ColumnDefinition Width="120"/>
													<ColumnDefinition Width="130"/>
													<ColumnDefinition Width="130"/>

												</Grid.ColumnDefinitions>
												<Grid.RowDefinitions>
													<RowDefinition Height="30"/>
													<RowDefinition Height="30"/>
													<RowDefinition Height="30"/>
												</Grid.RowDefinitions>
												<TextBlock Grid.Column="1" Margin ="5" Text="Имя"/>
												<TextBlock Grid.Column="2" Margin ="5" Text ="Тип соединения"/>
												<TextBlock Grid.Column="3" Margin ="5" Text ="Строка подключения"/>
												<TextBlock Grid.Column="4" Margin ="5" Text ="Кодировка"/>
												<TextBlock Grid.Column="5" Margin ="5" Text ="Стирание, мс" HorizontalAlignment="Left" VerticalAlignment="Center"/>
												<TextBlock Grid.Column="6" Margin ="5" Text ="Запись, мс" HorizontalAlignment="Left" VerticalAlignment="Center"/>
												<TextBlock Grid.Column="7" Margin ="5" Text ="Чтение, мс" HorizontalAlignment="Left" VerticalAlignment="Center"/>
												<TextBlock Grid.Column="8" Margin ="5" Text ="ErasePhysical" HorizontalAlignment="Left" VerticalAlignment="Center"/>
												<TextBlock Grid.Column="9" Margin ="5" Text ="EraseVirtual" HorizontalAlignment="Left" VerticalAlignment="Center"/>

												<Button ToolTip.Tip="Удалить эту конфигурацию прибора" Grid.Column="9" HorizontalAlignment="Right" CommandParameter="{Binding}" Command="{Binding DataContext.RemoveConfigurationCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}}" Background="AliceBlue" BorderBrush="AliceBlue" FontWeight="DemiBold" Margin="1">
													<StackPanel Orientation="Horizontal">
														<Image  Source="/Assets/Cancel_16x.png" Height="20"/>
													</StackPanel>
												</Button>
												<Button ToolTip.Tip="Переместить выше" Grid.Column="0" Grid.Row ="0" Grid.RowSpan="2" CommandParameter="{Binding}" Command="{Binding DataContext.MoveConfigUpCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}}" Background="AliceBlue" BorderBrush="AliceBlue">
													<StackPanel Orientation="Horizontal">
														<Image  Source="/Assets/StepBackArrow_16x.png" Height="20"/>
													</StackPanel>
												</Button>
												<Button ToolTip.Tip="Переместить ниже"
														Grid.Column="0" Grid.Row="1" Grid.RowSpan="2" CommandParameter="{Binding}" Command="{Binding DataContext.MoveConfigDownCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window}}" Background="AliceBlue" BorderBrush="AliceBlue">
													<StackPanel Orientation="Horizontal">
														<Image  Source="/Assets/StepOverArrow_16x.png" Height="20"/>
													</StackPanel>
												</Button>
												<TextBox Text="{Binding Name}" Grid.Column="1" Grid.Row="1" Margin ="5"/>
												<ComboBox Margin ="5" Grid.Column="2" Grid.Row="1" ItemsSource="{Binding ChannelTypes}" HorizontalAlignment="Stretch" SelectedItem="{Binding ChannelType, Mode=TwoWay}" VerticalContentAlignment="Center"/>

					
						
												<TextBox Text="{Binding ConnectionString}" Grid.Column="3" Grid.Row="1" Margin ="5"/>
												
												<ComboBox Margin ="5" Grid.Column="4" Grid.Row="1" HorizontalAlignment="Stretch" ItemsSource="{Binding Encodes}" Height="30" SelectedItem="{Binding SelectedEncode}" VerticalContentAlignment="Center">
													<ComboBox.ItemTemplate>
														<DataTemplate>
															<StackPanel Orientation="Horizontal">
																<TextBlock Text="{Binding Name}" Margin="5,0"/>
															</StackPanel>
														</DataTemplate>
														</ComboBox.ItemTemplate>
												</ComboBox>
												<TextBox Text="{Binding EraseTimeOut}" Width="110" Grid.Column="5" Grid.Row="1" Margin ="5"/>
												<TextBox Text="{Binding WriteTimeOut}" Width="110" Grid.Column="6" Grid.Row="1" Margin ="5"/>
												<TextBox Text="{Binding ReadTimeOut}"  Width="110" Grid.Column="7" Grid.Row="1" Margin ="5"/>
												<TextBox Text="{Binding ErasePhysicalAddr}" Width="120" Grid.Column="8" Grid.Row="1" Margin ="5"/>
												<TextBox Text="{Binding EraseVirtualAddr}"  Width="120" Grid.Column="9" Grid.Row="1" Margin ="5"/>
											</Grid>
										</views:GroupBox>

										<views:GroupBox Grid.Row="0" BorderBrush="DarkGray" Background="AliceBlue" Margin="5" Header="Секции">

											<Grid>
												<Grid.ColumnDefinitions>
													<ColumnDefinition Width="30" />
													<ColumnDefinition Width="30"/>
													<ColumnDefinition Width="3*"/>
													<ColumnDefinition Width="130"/>
													<ColumnDefinition Width="130"/>
													<ColumnDefinition Width="130"/>
													<ColumnDefinition Width="130"/>
													<ColumnDefinition Width="130"/>
													<ColumnDefinition Width="3*"/>
												</Grid.ColumnDefinitions>

												<Grid.RowDefinitions>
													<RowDefinition Height="30"/>
													<RowDefinition/>
													<RowDefinition/>
												</Grid.RowDefinitions>

												<TextBlock Grid.Column="2" Margin ="5" Text="Имя"/>
												<TextBlock Grid.Column="3" Margin ="5" Text ="Адрес"/>
												<TextBlock Grid.Column="4" Margin ="5" Text ="Размер"/>
												<TextBlock Grid.Column="5" Margin ="5" Text ="Виртуальный"/>
												<TextBlock Grid.Column="6" Margin ="5" Text ="Big Endian"/>
												<TextBlock Grid.Column="7" Margin ="5" Text ="Формат"/>
												<TextBlock Grid.Column="8" Margin ="5" Text ="Расширения"/>

												<ItemsControl Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="9" ItemsSource="{Binding AllSections}">
													<ItemsControl.DataTemplates>
														<DataTemplate DataType="vm:MemorySectionConfigurationVm" >
															<Border Background="#c6d8ff">
																<Grid>
																	<Grid.ColumnDefinitions>
																		<ColumnDefinition Width="30"/>
																		<ColumnDefinition Width="30"/>
																		<ColumnDefinition Width="3*"/>
																		<ColumnDefinition Width="130"/>
																		<ColumnDefinition Width="130"/>
																		<ColumnDefinition Width="130"/>
																		<ColumnDefinition Width="130"/>
																		<ColumnDefinition Width="130"/>
																		<ColumnDefinition Width="3*"/>
																	</Grid.ColumnDefinitions>

																	<Grid.RowDefinitions>
																		<RowDefinition Height="25"/>
																		<RowDefinition Height="30"/>
																	</Grid.RowDefinitions>

																	<Button ToolTip.Tip="Удалить эту конфигурацию секции памяти" Grid.Column="0" Grid.Row ="0" Grid.RowSpan="2" CommandParameter="{Binding}" Command="{Binding DataContext.RemoveMemorySectionCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Grid, AncestorLevel=2}}" Background="#c6d8ff" BorderBrush="#c6d8ff" FontWeight="DemiBold" Margin="1">
																		<StackPanel Orientation="Horizontal">
																			<Image Source="/Assets/Cancel_16x.png" Height="16"/>
																		</StackPanel>
																	</Button>
																	<Button ToolTip.Tip="Переместить выше" Grid.Column="1" Grid.Row ="0" CommandParameter="{Binding}" Command="{Binding DataContext.MoveSectionUpCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Grid, AncestorLevel=2}}" Background="#c6d8ff" BorderBrush="#c6d8ff" Margin="0,10,0,0">
																		<StackPanel Orientation="Horizontal">
																			<Image Source="/Assets/ExpandChevronUp_16x.png" Height="20"/>
																		</StackPanel>
																	</Button>
																	<Button ToolTip.Tip="Переместить ниже" Grid.Column="1" Grid.Row="1" CommandParameter="{Binding}" Command="{Binding DataContext.MoveSectionDownCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Grid, AncestorLevel=2}}" Background="#c6d8ff" BorderBrush="#c6d8ff" Margin="0,5,0,10">
																		<StackPanel Orientation="Horizontal">
																			<Image Source="/Assets/ExpandChevronDown_16x.png" Height="20"/>
																		</StackPanel>
																	</Button>

																	<TextBox Text="{Binding Name}" Grid.Column="2" Grid.Row ="0" Grid.RowSpan="2" Margin ="5" VerticalContentAlignment="Center" Height="20"/>
																	<TextBox Grid.Column="3" Grid.Row ="0" Grid.RowSpan="2" Margin ="5" VerticalContentAlignment="Center" FontFamily="Lucida Console" FontSize="15" Height="20">
																		<TextBox.Text>
																			<Binding Path="Address">
																				<Binding.Converter>
																					<converters:UIntToStringConverter/>
																				</Binding.Converter>
																			</Binding>
																		</TextBox.Text>
																	</TextBox>
																	<TextBox Grid.Column="4" Grid.Row ="0" Grid.RowSpan="2" Margin ="5" VerticalContentAlignment="Center" FontFamily="Lucida Console" FontSize="15" Height="20">
																		<TextBox.Text>
																			<Binding Path="Size">
																				<Binding.Converter>
																					<converters:UIntToStringConverter/>
																				</Binding.Converter>
																			</Binding>
																		</TextBox.Text>
																	</TextBox>
																	<CheckBox Grid.Row ="0" Grid.RowSpan="2" IsChecked="{Binding IsVirtual, Mode=TwoWay}" Grid.Column="5"  Margin ="5" HorizontalAlignment="Center"/>
																</Grid>
															</Border>
														</DataTemplate>

														<DataTemplate DataType="vm:FileSectionConfigurationVm">
															<Border Background="#fdeed9">
																<Grid>
																	<Grid.ColumnDefinitions>
																		<ColumnDefinition Width="30"/>
																		<ColumnDefinition Width="30"/>
																		<ColumnDefinition Width="3*"/>
																		<ColumnDefinition Width="130"/>
																		<ColumnDefinition Width="130"/>
																		<ColumnDefinition Width="130"/>
																		<ColumnDefinition Width="130"/>
																		<ColumnDefinition Width="130"/>
																		<ColumnDefinition Width="3*"/>
																	</Grid.ColumnDefinitions>

																	<Grid.RowDefinitions>
																		<RowDefinition Height="25"/>
																		<RowDefinition Height="30"/>
																	</Grid.RowDefinitions>

																	<Button ToolTip.Tip="Удалить эту конфигурацию секции памяти" Grid.Column="0" Grid.Row ="0" Grid.RowSpan="2" CommandParameter="{Binding}" Command="{Binding DataContext.RemoveMemorySectionCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Grid, AncestorLevel=2}}" Background="#fdeed9" BorderBrush="#fdeed9" FontWeight="DemiBold" Margin="1">
																		<StackPanel Orientation="Horizontal">
																			<Image Source="/Assets/Cancel_16x.png" Height="16"/>
																		</StackPanel>
																	</Button>
																	<Button ToolTip.Tip="Переместить выше" Grid.Column="1" Grid.Row ="0" CommandParameter="{Binding}" Command="{Binding DataContext.MoveSectionUpCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Grid, AncestorLevel=2}}" Background="#fdeed9" BorderBrush="#fdeed9" Margin="0,10,0,0">
																		<StackPanel Orientation="Horizontal">
																			<Image Source="/Assets/ExpandChevronUp_16x.png" Height="20"/>
																		</StackPanel>
																	</Button>
																	<Button ToolTip.Tip="Переместить ниже" Grid.Column="1" Grid.Row="1" CommandParameter="{Binding}" Command="{Binding DataContext.MoveSectionDownCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Grid, AncestorLevel=2}}" Background="#fdeed9" BorderBrush="#fdeed9" Margin="0,5,0,10">
																		<StackPanel Orientation="Horizontal">
																			<Image Source="/Assets/ExpandChevronDown_16x.png" Height="20"/>
																		</StackPanel>
																	</Button>

																	<TextBox Text="{Binding Name}"  Margin ="5" Grid.Column="2" Grid.RowSpan="2" Height="20"/>
																	<TextBox Grid.Column="3" Grid.RowSpan="2" Margin ="5" VerticalContentAlignment="Center" FontFamily="Lucida Console" FontSize="15" Height="20">
																		<TextBox.Text >
																			<Binding Path="Address">
																				<Binding.Converter>
																					<converters:UIntToStringConverter/>
																				</Binding.Converter>
																			</Binding>
																		</TextBox.Text>
																	</TextBox>
																	<TextBox Grid.Column="4" Grid.RowSpan="2" Margin ="5" VerticalContentAlignment="Center" FontFamily="Lucida Console" FontSize="15" Height="20">
																		<TextBox.Text >
																			<Binding Path="Size">
																				<Binding.Converter>
																					<converters:UIntToStringConverter/>
																				</Binding.Converter>
																			</Binding>
																		</TextBox.Text>
																	</TextBox>
																	<CheckBox IsChecked="{Binding IsVirtual, Mode=TwoWay}" Grid.Column="5" Grid.RowSpan="2" Margin ="5" HorizontalAlignment="Center" Height="20"/>
																	<CheckBox IsChecked="{Binding BigEndianHeader, Mode=TwoWay}" Grid.Column="6" Grid.RowSpan="2" Margin ="5" HorizontalAlignment="Center" Height="20"/>
																	<ComboBox Grid.Column="7" Grid.RowSpan="2" Margin ="5" HorizontalAlignment="Stretch" ItemsSource="{Binding Formats}" SelectedItem="{Binding SelectedFormat}" Height="20" VerticalContentAlignment="Center"
																			  VerticalAlignment="Center"/>
																	<TextBox Text="{Binding Extensions}" Grid.Column="8" Grid.RowSpan="2" Margin ="5" Height="20"/>
																</Grid>
															</Border>
														</DataTemplate>
													</ItemsControl.DataTemplates>
												</ItemsControl>

												<Button Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Margin="3" FontWeight="DemiBold"  BorderBrush="AliceBlue" Background="AliceBlue"
													Command="{Binding AddMemorySectionCommand}">
													<StackPanel Orientation="Horizontal">
														<Image  Source="/Assets/Add_16x.png"/>
														<TextBlock Text="СЕКЦИЯ"  Margin="10,0"/>
													</StackPanel>
												</Button>

												<Button Grid.Row="2" Grid.Column="2" Margin="3" FontWeight="DemiBold" BorderBrush="AliceBlue" Background="AliceBlue" HorizontalAlignment="Right"
													Command="{Binding AddFileSectionCommand}">
													<StackPanel Orientation="Horizontal">
														<Image  Source="/Assets/Add_16x.png"/>
														<TextBlock Text="ФАЙЛОВАЯ СЕКЦИЯ"  Margin="10,0"/>
													</StackPanel>
												</Button>
											</Grid>
										</views:GroupBox>
									</StackPanel>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</DockPanel>
			</ScrollViewer>
		</DockPanel>
	</Grid>
</Window>
